<macros>
    <token name="@MAFFT_PATH@">mafft</token>
	<token name="@MAFFT_COMMAND@">
		##Do not report progress
		--quiet

		## specify threads to use
		--thread \${GALAXY_SLOTS:-1}

		$adjustdir

		#if $getTree.value == True
		--treeout
		#end if

		$datatype

		#if $matrix_condition.use_matrix == True :

		#if $matrix_condition.matrix_selected.matrix == "PAM":
		--jtt ${matrix_condition.matrix_selected.PAM}
		#else
		--bl ${matrix_condition.matrix_selected.matrix}
		#end if
		#end if

		#if $method_condition.choice == "custom" :
		--$method_condition.distance_method
		--ep $ep
		--maxiterate $maxiterate

		#else:
		$method_condition.alignmentM
		#end if

		--op $op

		$reorder

		$outputFormat.value

		$inputSequences > $outputAlignment;
		
		#if $getTree.value == True:
		mv ${inputSequences}.tree $outputTree;
		#end if
	</token>
	<xml name="mafft_opt">
		<param name="inputSequences" format="fasta" type="data" label="Source file"
			help="Fasta sequence file" />
		<param name="datatype" type="select" label="Data type">
			<option value="">Auto detection</option>
			<option value="--nuc">Nucleic acids</option>
			<option value="--amino">Amino acids</option>
		</param>
		<conditional name="matrix_condition">
			<param name="use_matrix" type="boolean" truevalue="true"
				falsevalue="false" checked="False" label="Use matrix ?"
				help="Usefull only for amino acids" />
			<when value="true">
				<conditional name="matrix_selected">
					<param name="matrix" type="select" label="Matrix">
						<option value="30">BLOSUM 30</option>
						<option value="45">BLOSUM 45</option>
						<option value="62" selected="true">BLOSUM 62</option>
						<option value="80">BLOSUM 80</option>
						<option value="PAM">PAM</option>
					</param>
					<when value="PAM">
						<param name="PAM" type="integer" value="80" min="1" max="350"
							label="Coefficient of the PAM matrix" />
					</when>
				</conditional>
			</when>
		</conditional>

		<conditional name="method_condition">
			<param name="choice" type="select" label="Methods"
				help="Accuracy-oriented methods recommended for maximum 200 sequences">
				<option value="speed">Speed-oriented methods</option>
				<option value="accuracy">Accuracy-oriented methods</option>
				<option value="custom">Choice your algorithm and params</option>
			</param>
			<when value="speed">
				<param name="alignmentM" type="select" display="radio"
					label="Alignment methods">
					<option value="--retree 2 --maxiterate 1000">FFT-NS-i (iterative refinement method; max.
						1000
						iterations)
					</option>
					<option value="--retree 2 --maxiterate 0" selected="true">FFT-NS-2
						(fast; progressive method)
					</option>
					<option value="--retree 1 --maxiterate 0">FFT-NS-1 (very fast; recommended for >2000
						sequences)
					</option>
					<option value="--retree 2 --maxiterate 2 --nofft">NW-NS-i (iterative refinement method without
						FFT
						approximation; two cycles only )
					</option>
					<option value="--retree 2 --maxiterate 0 --nofft">NW-NS-2 (fast; progressive method without the
						FFT approximation)
					</option>
					<option value="--retree 1 --maxiterate 0 --nofft --parttree">NW-NS-PartTree-1 (recommended for ~10,000 to
						~50,000 sequences)
					</option>
				</param>
			</when>
			<when value="accuracy">
				<param name="alignmentM" type="select" display="radio"
					label="Alignment methods">
					<option value="--localpair --maxiterate 1000">L-INS-i
						(probably most accurate)
					</option>
					<option value="--globalpair --maxiterate 1000">G-INS-i (suitable for sequences of similar
						lengths)
					</option>
					<option value="--genafpair --maxiterate 1000 --ep=0">E-INS-i (suitable for sequences containing
						large
						unalignable regions)
					</option>
				</param>
			</when>
			<when value="custom">
				<param type="select" name="distance_method" display="radio"
					label="Distance method" help="Distance method must be chosen regarding your data">
					<option value="6merpair" selected="true">Shared 6mers distance
						(fastest)
					</option>
					<option value="globalpair">Global alignment (NW)</option>
					<option value="localpair">Local alignment (SW)</option>
					<option value="genafpair">Local, affine gap cost</option>
					<option value="fastapair">FASTA distance</option>
				</param>
				<param name="ep" type="float" value="0.123" label="Gap extend penalty"
					help="0.123 default value" />
				<param name="iterations" type="integer" value="1" min="1" max="1000"
					label="Maximum number of iterations" help="1000 for maximum quality" />
			</when>
		</conditional>
		<param name="op" type="float" value="1.53" label="Gap opening penalty"
			help="1.53 default value" />
		<param name="adjustdir" type="boolean" truevalue="--adjustdirection"
			falsevalue="" checked="False" label="Adjust direction?" />
		<param name="getTree" type="boolean" truevalue="true"
			falsevalue="false" checked="False" label="Display alignment tree ?" />
		<param name="reorder" type="boolean" truevalue="--reorder"
			falsevalue="" checked="False" label="Reorder output?" />
		<param name="outputFormat" type="select" label="Output format"
			help="Either FASTA or ClustalW">
			<option value="" selected="true">FASTA</option>
			<option value="--clustalout">ClustalW</option>
			<option value="--phylipout">Phylip</option>
		</param>
	</xml>
	<xml name="mafft_output">
	   <data name="outputAlignment" format="fasta" label="${tool.name} Alignment">
            <change_format>
                <when input="outputFormat" value="clustalw" format="clustal"/>
            </change_format>
        </data>
        <data name="outputTree" format="txt" label="${tool.name} Guide Tree">
            <filter>getTree == True </filter>
        </data> 
	</xml>
</macros>
