<tool id="Clean-1.0" name="Clean" version="1.0">
	<description>Cleaning sequences</description>
	<command interpreter="bash">clean.sh 
								-z $a.choice	
				#if $a.choice == "true" :
								-a $a.prog.progChoice
								-i $a.input
								-o $output
					#if $a.prog.progChoice == "gblocks" :
								-b "$a.prog.datatype $a.prog.b1 $a.prog.b2 $a.prog.b3 $a.prog.b4 $a.prog.b5"
					#end if
					#if $a.prog.progChoice == "BMGE" :
								-c "$a.prog.dataType.codeSeq $a.prog.dataType.matrice$a.prog.dataType.estimated $a.prog.windowsSize $a.prog.rateCutOff $a.prog.minBlock $a.prog.formats"
					#end if
					#if $a.prog.progChoice == "trimal" :
								-d $a.prog.select.choice							
						#if $a.prog.select.choice == "default" :
								-e $a.prog.select.selection
						#end if
						#if $a.prog.select.choice == "userC" :
							#if $a.prog.select.gtin
								-f $a.prog.select.gtin
							#end if
							#if $a.prog.select.stin
								-g $a.prog.select.stin
							#end if
							#if $a.prog.select.consin
								-h $a.prog.select.consin
							#end if
						#end if
					#end if
				#end if
	</command>
	<inputs>
		<conditional name="a">
			<param name="choice" type="select" label="Cleaning sequencies">
				<option value="true">Yes</option>
				<option value="false">No</option>
			</param>
			<when value="true">
				<param name="input" format="fasta" type="data" label="Source file" help="Fasta sequence file"/>				
				<conditional name="prog">
					<param name="progChoice" type="select" label="Choose the clean program">
					<option value="gblocks">GBlocks</option>
					<option value="BMGE">BMGE</option>
					<option value="trimal">trimAl</option>
					</param>
					<when value="gblocks">
						<param type="select" name="datatype" label="Data type">
							<option value="d">DNA</option>
							<option value="p">Protein</option>
							<option value="c">Codon</option>
						</param>
						<param type="text" name="b1" help="Percentage, must be superior to 50" value="51" label="Minimum number of sequences for a conserved position" />
						<param type="text" name="b2" help="Percentage, must be superior to the minimum number of sequences for a conserved position" value="85" label="Minimum number of Sequences for a flank position" />
						<param type="text" name="b3" help="Any integer" value="8" label="Maximum number Of contiguous nonconserved positions" />
						<param type="text" name="b4" help="Any integer equal or bigger than 2" value="10" label="Minimum length of a block" />
						<param type="select" name="b5" label="Allowed gap positions">
							<option value="n">None</option>
							<option value="h">With half</option>
							<option value="a">All</option>
						</param>
					</when>
					<when value="BMGE">
						<param name="formats" type="select" label="Output File Formats">
							<option value="p">Phylip</option>
							<option value="f">Fasta</option>
							<option value="n">Nexus</option>
							<option value="h">HTML</option>
						</param> 
 						<conditional name="dataType">
							<param name="codeSeq" type="select" label="Sequence Coding">
								<option value="DNA">DNA</option>
								<option value="AA">AA</option>
								<option value="CODON">Codon</option>
							</param>
							<when value="DNA"> 
								<param name="matrice" type="hidden" label="matrice"  value="DNAPAM"/>                                           	 
								<param name="estimated" type="integer" label="Estimated matrice PAM [ 1-500 ]"  value="250" min="1" max="500"/>   
							</when>
							<when value="AA">
								<param name="matrice" type="hidden" label="matrice" value="BLOSUM"/>
								<param name="estimated" type="select" label="Estimated matrice BLOSUM">   
									<option value="62">62</option>
									<option value="30">30</option>
									<option value="35">35</option>
									<option value="40">40</option>
									<option value="45">45</option>
									<option value="50">50</option>
									<option value="55">55</option>
									<option value="60">60</option>
									<option value="65">65</option>
									<option value="70">70</option>
									<option value="75">75</option>
									<option value="80">80</option>
									<option value="85">85</option>
									<option value="90">90</option>
									<option value="95">95</option>
								</param>
							</when>
							<when value="CODON">
								<param name="matrice" type="hidden" label="matrice" value="BLOSUM"/>
								<param name="estimated" type="select" label="estimated matrice BLOSUM">  
									<option value="62">62</option>
									<option value="30">30</option>
									<option value="35">35</option>
									<option value="40">40</option>
									<option value="45">45</option>
									<option value="50">50</option>
									<option value="55">55</option>
									<option value="60">60</option>
									<option value="65">65</option>
									<option value="70">70</option>
									<option value="75">75</option>
									<option value="80">80</option>
									<option value="85">85</option>
									<option value="90">90</option>
									<option value="95">95</option>
								</param>
							</when>
						</conditional>	
						<param name="windowsSize" type="select" label="Sliding Windows Size">
							<option value="3">3</option>		
							<option value="1">1</option>
							<option value="5">5</option>
							<option value="7">7</option>
						</param> 
						<param name="rateCutOff" type="float" label="Gap Rate cut-off  [ 0-1 ]" value="0.2" min="0" max="1"/>   
						<param name="minBlock" type="integer" label="Minimum Block Size" value="5"/> 
					</when>
					<when value="trimal">
						<conditional name="select">
							<param name="choice" type="select" label="How to select sites to be removed">
								<option value="default">Let trimAl select sites</option>
								<option value="userC">User parameters</option>
							</param>
							<when value="default">
								<param name="selection" type="select" label="Predefined cleaning strategy">
									<option value="-strictplus">Strictplus: Optimized for Neighbour Joining phylogenetic tree reconstruction</option>
									<option value="-gappyout">Gappyout: only uses information based on gaps' distribution</option>
									<option value="-automated1">Automated: Optimized for Maximum Likelihood phylogenetic tree reconstruction</option>
									<option value="-strict">Strict automated selection</option>
							</param>
							</when>
							<when value="userC">
								<param name="gtin" type="text" label="Fraction of sequences with a gap allowed" optional="true" help="0 to 1, with 1 will remove all columns with any gap"/>
								<param name="stin" type="float" label="Minimum average similarity allowed" optional="true" help="0 to 1, for example 0.001 value will remove all columns with a similarity score lower than 0.001"/>
								<param name="consin" type="integer" label="Minimum percentage of the positions in the original alignment to conserve" optional="true" help="0 to 100, for example 60 value will conserve at least 60% of the columns"/>
							</when>
						</conditional>
					</when>
				</conditional>
			</when>
			<when value="false">
			</when>
		</conditional>
	</inputs>
	<outputs>
		<data format="txt" name="output" label="Cleaning sequencies "/>
	</outputs>
	<help>
.. class:: infomark

**Program encapsulated in Galaxy by ATGC (C. Vernette, V. Lefort)**

-----

===========
Overview:
===========

Meta-brick for to clean aligned sequences for phylogenetic analyses.
  
	</help>
</tool>
