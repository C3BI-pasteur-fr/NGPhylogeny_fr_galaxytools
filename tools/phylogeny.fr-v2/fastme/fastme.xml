<tool id="FastME" name="FastME">

	<description>distance based inference of phylogenetic trees</description>

	<command interpreter="bash">fastme -i $input 
						-o $treeOutput 
						-I $statOutput 
						-O $matrixOutput
					#if $bootChoice.boot =="true":
						-B $bootOutput
						-b $bootChoice.replicates
					#end if	
					#if $typeChoice.datatype =="d":
						-D $typeChoice.model
					#else 
						-P $typeChoice.model
					#end if
						$equilibrium
					#if $gammaChoice.gamma == "true":
						-g $gammaChoice.rate
					#end if
						$removeGap
						-m $method
						-n $NNI
						$SPR
						-w b 
									     
	</command>

	<inputs>
		<param name="input" format="txt" type="data" label="Source file" help="Phylip format"/>
		<conditional name="typeChoice">
			<param name="datatype" type="select"  label="Data type">
				<option value="d">DNA</option>
				<option value="p">Protein</option>
			</param>
			<when value="d">
				<param name="model" type="select" label="Evolutionary model">
					<option value="4">F84</option>
					<option value="R">RY</option>
					<option value="1">F81</option>
					<option value="J">JC69</option>
					<option value="K">K2P</option>
					<option value="T">TN</option>
					<option value="p">p-distance</option>
				</param>
			</when>
			<when value="p">
				<param name="model" type="select" label="Evolutionary model">
					<option value="L">LG</option>
					<option value="W">WAG</option>
					<option value="J">JTT</option>
					<option value="h">Day off</option>
					<option value="C">CpRev</option>
					<option value="D">DCMut</option>
					<option value="b">HIVb</option>
					<option value="I">HIVw</option>
					<option value="M">MtREV</option>
					<option value="R">RtREV</option>					
					<option value="p">p-distance</option>					
				</param>			
			</when>
		</conditional>
		<param name="equilibrium" type="boolean" label="Equilibrium frequencies" truevalue="-e" falsevalue="" help="By default, frequencies are globally counted from the nucleotides alignment or defined by the proteic substitution model. By checking the box, frequencies are pairwise estimated by counting the nucleotides or estimated by counting the amino-acids in the alignment."/>
		<conditional name="gammaChoice">
			<param name="gamma" type="select" label="Gamma distributed rates across sites">
				<option value="true">Yes</option>
				<option value="false">No</option>
			</param>
			<when value="true">
				<param name="rate" type="float" label="Gamma distribution parameter" value="1" min="0"/>
			</when>
			<when value="false">
			</when>
		</conditional>
		<param name="removeGap" type="boolean" label="Remove all sites containing gap" truevalue="-r" falsevalue=""/>
		<param name="method" type="select" label="Distance algorithm">
			<option value="I">BIONJ</option>
			<option value="b">balanced GME</option>
			<option value="N">NJ</option>
			<option value="U">UNJ</option>
		</param>
		<param name="NNI" type="boolean" label="Tree swapping NNI" truevalue="b" falsevalue="n" checked="true"/>
		<param name="SPR" type="boolean" label="Tree swapping SPR" truevalue="-s" falsevalue=""/>
		<conditional name="bootChoice">
			<param name="boot" type="select" label="Bootstrap">
				<option value="false">No</option>
				<option value="true">Yes</option>			
			</param>
			<when value="true">
				<param name="replicates" type="text" value="100" label="Number of replicatess"/>
			</when>
			<when value="false">
			</when>
		</conditional>
	</inputs>

	<outputs>
		<data name="treeOutput" format="nhx" label="FastME Tree"/>
		<data name="statOutput" format="txt" label="FastME Information"/>
		<data name="bootOutput" format="nhx" label="FastME Bootstrap">
			<filter>bootChoice['boot'] == "true"</filter>
		</data>
		<data name="matrixOutput" format="txt" label="FastME Distance matrix"/>
	</outputs>

	<help>

.. class:: infomark

**FastME version 2.1.2**

.. class:: infomark

**Program encapsulated in Galaxy by ATGC (C. Vernette, V. Lefort)**

-----
	
==============
 Please cite: 
==============

"Fast_ and accurate phylogeny reconstruction algorithms based on the minimum-evolution principle." 


.. _Fast: http://online.liebertpub.com/doi/abs/10.1089/106652702761034136

**Desper R., Gascuel O.**

Journal of Computational Biology. 2002 9(5):687-705.

-----

==========
 Overview
==========

FastME first builds an initial tree, using either OLS_GME, balanced_GME, NJ or BIONJ algorithms, and then improves this tree by tree swapping, using either OLS_NNI or balanced_NNI algorithms. OLS_GME and OLS_NNI optimize the ordinary least-squares (OLS) version of the minimum-evolution principle, while balanced_GME and balanced_NNI optimize the balanced version.

-----

For further informations, please visite FastME_


.. _FastME: http://www.atgc-montpellier.fr/fastme/usersguide.php

	</help>
</tool>
