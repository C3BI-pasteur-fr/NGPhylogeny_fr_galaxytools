<tool id="fastme" name="FastME" version="2.1.4.1">
	<description>Distance-based inference of phylogenetic trees</description>
	<requirements>
        <requirement type="package" version="2.1.4">fastme</requirement>
    </requirements>
    <version_command>
        <![CDATA[ fastme --version ]]>
    </version_command>
    <stdio>
        <exit_code range="1:" level="fatal" />
    </stdio>
	<command>fastme -i $input 
					-o $outputTree 
					-I $outputLog 
					-O $outputMatrix
					#if $bootChoice.boot =="true":
						-B $outputBoostrap
						-b $bootChoice.replicates
					#end if
						
					#if $typeChoice.datatype =="d":
						-d $typeChoice.modeldna
					#else if $typeChoice.datatype =="p":
						-p $typeChoice.modelprot
				    #else:
		                 ## Read information of sequence type:
			             ## read an info file to choose which option set and set a model by default
			             #set $info = open( str($input_info) ).read()
			             #if 'dna' in $info:
			                    -d T
			             #else if 'protein' in $info:
			                    -p L
			             #end if
				    
					#end if
					
					$equilibrium
					#if $gammaChoice.gamma == "true":
						-g $gammaChoice.rate
					#end if
					$removeGap
					-m $distance
					-n $NNI 
					$SPR
					$TBR
					-w b >> $outputLog ;
	</command>

	<inputs>
		<param name="input" type="data" format="phylip" label="Phylip input"/>
		<param name="fileout_label" type="text" value="Newick tree" label="Output name" help="Output name for files" />
		<conditional name="typeChoice">
			<param name="datatype" type="select"  label="Data type" >
				<option value="d">DNA</option>
				<option value="p">Protein</option>
				<option value="auto">Specified in a file</option>
			</param>
			<when value="d">
				<param name="modeldna" type="select" label="Evolutionary model">
					<option value="4">F84</option>
					<option value="R">RY</option>
					<option value="1">F81</option>
					<option value="J">JC69</option>
					<option value="K">K2P</option>
					<option value="T">TN93</option>
					<option value="p">p-distance</option>
				</param>
			</when>
			<when value="p">
				<param name="modelprot" type="select" label="Evolutionary model">
					<option value="L">LG</option>
					<option value="W">WAG</option>
					<option value="J">JTT</option>
					<option value="h">Day off</option>
					<option value="C">CpRev</option>
					<option value="D">DCMut</option>
					<option value="b">HIVb</option>
					<option value="I">HIVw</option>
					<option value="M">MtREV</option>
					<option value="R">RtREV</option>					
					<option value="p">p-distance</option>					
				</param>			
			</when>
			<when value="auto">
			     <param name="input_info" format="txt" type="data" multiple="false" label="sequence type info" help="Precompute file containning sequence description (dna or protein)"/>
			</when>
		</conditional>
		<param name="equilibrium" type="boolean" label="Equilibrium frequencies" truevalue="-e" falsevalue="" help="By default, frequencies are globally counted from the nucleotides alignment or defined by the proteic substitution model. By checking the box, frequencies are pairwise estimated by counting the nucleotides or estimated by counting the amino-acids in the alignment."/>
		<conditional name="gammaChoice">
			<param name="gamma" type="select" label="Gamma distributed rates across sites">
				<option value="true">Yes</option>
				<option value="false">No</option>
			</param>
			<when value="true">
				<param name="rate" type="float" label="Gamma distribution parameter" value="1" min="0"/>
			</when>
			<when value="false">
			</when>
		</conditional>
		<param name="removeGap" type="boolean" label="Remove all sites containing gap" truevalue="-r" falsevalue=""/>
		<param name="distance" type="select" label="Distance algorithm">
			<option value="I">BIONJ</option>
			<option value="b">balanced GME</option>
			<option value="N">NJ</option>
			<option value="U">UNJ</option>
		</param>
		<param name="NNI" type="select" display="radio" label="Tree swapping NNI" help='Nearest Neighbor Interchanges'>
		    <option value="n">No NNI move</option>
			<option value="b">Balanced NNI</option>
			<option value="O">LS NNI</option>
		</param>
		<param name="SPR" type="boolean" label="Tree swapping SPR" truevalue="-s" falsevalue="" checked="true" help="Subtree Pruning and Regraft"/>
		<param name="TBR" type="boolean"  truevalue="-t" falsevalue="" checked="false" label="Tree swapping TBR" help="Tree Bisection and Reconnection"/>
		
		<conditional name="bootChoice">
			<param name="boot" type="boolean" label="Bootstrap" truevalue="true" falsevalue="false" checked="false"/>
			<when value="true">
				<param name="replicates" type="text" value="100" label="Number of replicatess"/>
			</when>
			<when value="false">
			</when>
		</conditional>
	</inputs>
	<outputs>
		<data name="outputTree" format="nwk" label="${fileout_label}"/>
		<data name="outputLog" format="txt" label="FastME Information"/>
		<data name="outputBoostrap" format="nwk" label="FastME Bootstrap trees">
			<filter>bootChoice['boot'] == "true"</filter>
		</data>
		<data name="outputMatrix" format="txt" label="FastME Distance matrix"/>
	</outputs>
    <tests>
        <test>
         <param name="input" value="phylip" />
            <param name="modeldna" value="4"/>
            <param name="distance" value="I"/>
            <output name="treeOutput" file="newick" />
        </test>
    </tests>
	<help>

.. class:: infomark


**FastME version 2.1.4**


.. class:: infomark


**Galaxy integration** Andres Gwendoline, Institut FranÃ§ais de Bioinformatique.
**Support** For any questions about Galaxy integration, please send an e-mail to support.abims@sb-roscoff.fr


-----
	

======
FastMe
======

-----------
Description
-----------


    FastME - A distance based phylogeny reconstruction algorithm.

    FastME showed better topological accuracy than NJ,
    BIONJ, WEIGHBOR and FITCH, in all evolutionary
    conditions we tested, which include large range
    deviations from molecular clock and substitution rates.
    
    FastME first builds an initial tree, using either OLS_GME, balanced_GME, NJ or BIONJ algorithms, 
    and then improves this tree by tree swapping, using either OLS_NNI or balanced_NNI algorithms.
    OLS_GME and OLS_NNI optimize the ordinary least-squares (OLS) version of the minimum-evolution principle,
    while balanced_GME and balanced_NNI optimize the balanced version.




-----------------
Workflow position
-----------------

**Upstream tools**

=========== ========================== =======
Name            output file(s)         format 
=========== ========================== =======
Readseq     phylip conversion          phylip 
=========== ========================== =======


**Downstream tools**

=========== ========================== =======
Name            output file(s)         format
=========== ========================== =======
Rooting     out tree                   Newick 
=========== ========================== =======


----------
Input file
----------

Phylip file 
    Phylip file with sequence alignments
    

----------
Parameters
----------

Output name
        Output base name for the ouput files

Evolutionary model
    Indicate the evolutionary [model] which can be choosen from:p-distance, RY symmetric, RY, JC69, K2P, F81, F84 (default), TN93, LogDet.

Distance methode
    FastME computes a tree using a distance algorithm. You may choose this method/topologie from: TaxAdd_BalME, TaxAdd_OLSME, BIONJ (default), NJ, UNJ, NNI_BalME, NNI_OLS or SPR

------------
Output files
------------

Output_name
    Resulting tree at Newick format 

Output_name.log
    Log file

------------
Dependencies
------------
FastME
    http://www.atgc-montpellier.fr/fastme
    


---------------------------------------------------

---------------
Working example
---------------

Input files
===========

Philip file
-----------

::

    168 5125
    IRAT112      GAGAACCGTC CTGTAAGTAC TCTTGCTTTA AGTAATAAAG TAATACTAAT
    KARASUKARA   GAGAACCGTC CTGTAAGTAC TCTTGCTTTA AATACGAAAG TAATACTAAT

Parameters
==========

Output name -> Newick tree

Evolutionary model -> F84

Distance methode -> BIONJ

Output files
============

Newick tree
-----------

::

    (((((((((((((((((((((((((GOGOLEMPUK:0.001198,GOGOLEMPAK:0.002128):0.030378,TREMBESE:0.013258):0.055246,(((JIMBRUKJOL:0.045219,KETANKONIR:0.035298):0.006267, ...
    

-----


For further informations, please visite FastME_

.. _FastME: http://www.atgc-montpellier.fr/fastme/usersguide.php

	</help>
	<citations>
	   <citation type="doi">10.1093/molbev/msv150</citation>
       <citation type="doi">10.1089/106652702761034136</citation>
    </citations>
</tool>
